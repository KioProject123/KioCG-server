From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Joket_abc <15005771700@qq.com>
Date: Thu, 7 Dec 2023 14:22:10 +0800
Subject: [PATCH] Death drop protection


diff --git a/src/main/java/net/minecraft/server/level/ServerPlayer.java b/src/main/java/net/minecraft/server/level/ServerPlayer.java
index 90958ab4022113ada08a809edaeb7e3018f18a0b..5feb9a39ea77d9384f67540df72fec6935f43e20 100644
--- a/src/main/java/net/minecraft/server/level/ServerPlayer.java
+++ b/src/main/java/net/minecraft/server/level/ServerPlayer.java
@@ -1017,7 +1017,15 @@ public class ServerPlayer extends Player {
         if (!keepInventory) {
             for (ItemStack item : this.getInventory().getContents()) {
                 if (!item.isEmpty() && !EnchantmentHelper.hasVanishingCurse(item)) {
-                    loot.add(new DefaultDrop(item, stack -> this.drop(stack, true, false))); // Paper - drop function taken from Inventory#dropAll
+                    // KioCG start
+                    loot.add(new DefaultDrop(item, stack -> {
+                        ItemEntity droped = this.drop(stack, true, false);
+                        if (droped != null) {
+                            droped.setTarget(this.getUUID());
+                            droped.age = -32767;
+                        }
+                    })); // Paper - drop function taken from Inventory#dropAll
+                    // KioCG end
                 }
             }
         }
