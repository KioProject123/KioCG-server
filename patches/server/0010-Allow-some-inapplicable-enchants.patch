From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Joket_abc <15005771700@qq.com>
Date: Wed, 16 Nov 2022 22:37:53 +0800
Subject: [PATCH] Allow some inapplicable enchants


diff --git a/src/main/java/net/minecraft/world/inventory/AnvilMenu.java b/src/main/java/net/minecraft/world/inventory/AnvilMenu.java
index 09b202aea81de2844cc2ddefed39097eb0b69fbd..6f08e3f2780a16680de3bef70e4fe60c39e60314 100644
--- a/src/main/java/net/minecraft/world/inventory/AnvilMenu.java
+++ b/src/main/java/net/minecraft/world/inventory/AnvilMenu.java
@@ -226,6 +226,7 @@ public class AnvilMenu extends ItemCombinerMenu {
 
                             i2 = l1 == i2 ? i2 + 1 : Math.max(i2, l1);
                             boolean flag3 = canDoUnsafeEnchants || (org.purpurmc.purpur.PurpurConfig.allowUnsafeEnchants && org.purpurmc.purpur.PurpurConfig.allowInapplicableEnchants) || enchantment.canEnchant(itemstack); // Purpur
+                            flag3 = flag3 || enchantment instanceof net.minecraft.world.item.enchantment.BindingCurseEnchantment && net.minecraft.world.item.enchantment.EnchantmentCategory.VANISHABLE.canEnchant(itemstack.getItem()); // KioCG
                             boolean flag4 = true; // Purpur
 
                             if (this.player.getAbilities().instabuild || itemstack.is(Items.ENCHANTED_BOOK)) {
diff --git a/src/main/java/net/minecraft/world/item/enchantment/EnchantmentCategory.java b/src/main/java/net/minecraft/world/item/enchantment/EnchantmentCategory.java
index fc2c35f57436371cb0111aedfd289ac95d506d07..a09bd528218d44630300fcf8f263e7b164d7051d 100644
--- a/src/main/java/net/minecraft/world/item/enchantment/EnchantmentCategory.java
+++ b/src/main/java/net/minecraft/world/item/enchantment/EnchantmentCategory.java
@@ -135,6 +135,14 @@ public enum EnchantmentCategory {
             return WEAPON.canEnchant(item) || item instanceof net.minecraft.world.item.ShearsItem;
         }
     // Purpur end
+    // KioCG start
+    },
+    TOOL_AND_SHEARS {
+        @Override
+        public boolean canEnchant(Item item) {
+            return DIGGER.canEnchant(item) || item instanceof net.minecraft.world.item.ShearsItem;
+        }
+    // KioCG end
     };
 
     public abstract boolean canEnchant(Item item);
diff --git a/src/main/java/net/minecraft/world/item/enchantment/UntouchingEnchantment.java b/src/main/java/net/minecraft/world/item/enchantment/UntouchingEnchantment.java
index c4245ecf24066c708beb434a3b610fc7c6b07044..84550504d647224cb9e8559cf40aa6e98af10dc8 100644
--- a/src/main/java/net/minecraft/world/item/enchantment/UntouchingEnchantment.java
+++ b/src/main/java/net/minecraft/world/item/enchantment/UntouchingEnchantment.java
@@ -7,6 +7,13 @@ public class UntouchingEnchantment extends Enchantment {
         super(weight, EnchantmentCategory.DIGGER, slotTypes);
     }
 
+    // KioCG start
+    @Override
+    public boolean canEnchant(net.minecraft.world.item.ItemStack stack) {
+        return EnchantmentCategory.TOOL_AND_SHEARS.canEnchant(stack.getItem());
+    }
+    // KioCG end
+
     @Override
     public int getMinCost(int level) {
         return 15;
