From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Joket_abc <15005771700@qq.com>
Date: Sun, 17 Dec 2023 14:26:29 +0800
Subject: [PATCH] Transform spawned via mob spawner


diff --git a/src/main/java/net/minecraft/world/entity/Mob.java b/src/main/java/net/minecraft/world/entity/Mob.java
index b4dac6826da76ff573a74a3c9aaae54c5537d12a..db1070787b7cee58f68e45e91f984f19d7e4a85e 100644
--- a/src/main/java/net/minecraft/world/entity/Mob.java
+++ b/src/main/java/net/minecraft/world/entity/Mob.java
@@ -1535,6 +1535,7 @@ public abstract class Mob extends LivingEntity implements Targeting {
                     return null;
                 }
                 this.level().addFreshEntity(t0, spawnReason);
+                t0.spawnedViaMobSpawner = this.spawnedViaMobSpawner; // KioCG
                 // CraftBukkit end
                 if (this.isPassenger()) {
                     Entity entity = this.getVehicle();
diff --git a/src/main/java/net/minecraft/world/entity/animal/Cow.java b/src/main/java/net/minecraft/world/entity/animal/Cow.java
index 6d00b3cd4a9cb0fc8a9e9c27f37429a25fcf6e9d..f65a0dfe7b80c09f442b2ebcd210219dffdfbe6a 100644
--- a/src/main/java/net/minecraft/world/entity/animal/Cow.java
+++ b/src/main/java/net/minecraft/world/entity/animal/Cow.java
@@ -233,6 +233,7 @@ public class Cow extends Animal {
             return InteractionResult.PASS;
         }
         this.level().addFreshEntity(mooshroom);
+        mooshroom.spawnedViaMobSpawner = this.spawnedViaMobSpawner; // KioCG
         this.remove(RemovalReason.DISCARDED);
         if (!player.getAbilities().instabuild) {
             stack.shrink(1);
diff --git a/src/main/java/net/minecraft/world/entity/animal/MushroomCow.java b/src/main/java/net/minecraft/world/entity/animal/MushroomCow.java
index 3f00d40125b63a76ed549755d4c9d9a2ff2d4adf..c4800c716417716618880edc44609f898cd8235f 100644
--- a/src/main/java/net/minecraft/world/entity/animal/MushroomCow.java
+++ b/src/main/java/net/minecraft/world/entity/animal/MushroomCow.java
@@ -258,6 +258,7 @@ public class MushroomCow extends Cow implements Shearable, VariantHolder<Mushroo
                     return;
                 }
                 this.level().addFreshEntity(entitycow, org.bukkit.event.entity.CreatureSpawnEvent.SpawnReason.SHEARED);
+                entitycow.spawnedViaMobSpawner = this.spawnedViaMobSpawner; // KioCG
 
                 this.discard(); // CraftBukkit - from above
                 // CraftBukkit end
diff --git a/src/main/java/net/minecraft/world/entity/animal/frog/Tadpole.java b/src/main/java/net/minecraft/world/entity/animal/frog/Tadpole.java
index 14135dac80dec4224715e21cef6556d22e569026..2a883c24548aa0208f9dfefb65b694d63ba62a4b 100644
--- a/src/main/java/net/minecraft/world/entity/animal/frog/Tadpole.java
+++ b/src/main/java/net/minecraft/world/entity/animal/frog/Tadpole.java
@@ -285,6 +285,7 @@ public class Tadpole extends AbstractFish {
                 // CraftBukkit end
                 this.playSound(SoundEvents.TADPOLE_GROW_UP, 0.15F, 1.0F);
                 worldserver.addFreshEntityWithPassengers(frog, org.bukkit.event.entity.CreatureSpawnEvent.SpawnReason.METAMORPHOSIS); // CraftBukkit - add SpawnReason
+                frog.spawnedViaMobSpawner = this.spawnedViaMobSpawner; // KioCG
                 this.discard();
             }
         }
diff --git a/src/main/java/net/minecraft/world/entity/monster/Skeleton.java b/src/main/java/net/minecraft/world/entity/monster/Skeleton.java
index 82bcce358099a24e38c81b75b541bc38933d7885..d6d8da50850520a0067925b57fc0839d1564c4ca 100644
--- a/src/main/java/net/minecraft/world/entity/monster/Skeleton.java
+++ b/src/main/java/net/minecraft/world/entity/monster/Skeleton.java
@@ -234,6 +234,7 @@ public class Skeleton extends AbstractSkeleton {
         }
 
         this.level().addFreshEntity(skeleton);
+        skeleton.spawnedViaMobSpawner = this.spawnedViaMobSpawner; // KioCG
         this.remove(RemovalReason.DISCARDED);
         if (!player.getAbilities().instabuild) {
             stack.shrink(1);
diff --git a/src/main/java/net/minecraft/world/entity/monster/Slime.java b/src/main/java/net/minecraft/world/entity/monster/Slime.java
index 8b6f8fca8402c177c399824c6bf0bdef2c24ec55..f8f6441d5581874a6737723cf10b9bb09499340e 100644
--- a/src/main/java/net/minecraft/world/entity/monster/Slime.java
+++ b/src/main/java/net/minecraft/world/entity/monster/Slime.java
@@ -337,6 +337,7 @@ public class Slime extends Mob implements Enemy {
             }
             for (LivingEntity living : slimes) {
                 this.level().addFreshEntity(living, org.bukkit.event.entity.CreatureSpawnEvent.SpawnReason.SLIME_SPLIT); // CraftBukkit - SpawnReason
+                living.spawnedViaMobSpawner = this.spawnedViaMobSpawner; // KioCG
             }
             // CraftBukkit end
         }
diff --git a/src/main/java/net/minecraft/world/entity/npc/Villager.java b/src/main/java/net/minecraft/world/entity/npc/Villager.java
index d65919f91b29de051797454bf3dbcd4499d582ce..3495504f85a61aecfdd790e2318aad263d743cbc 100644
--- a/src/main/java/net/minecraft/world/entity/npc/Villager.java
+++ b/src/main/java/net/minecraft/world/entity/npc/Villager.java
@@ -1025,6 +1025,7 @@ public class Villager extends AbstractVillager implements ReputationEventHandler
                     return;
                 }
                 world.addFreshEntityWithPassengers(entitywitch, org.bukkit.event.entity.CreatureSpawnEvent.SpawnReason.LIGHTNING);
+                entitywitch.spawnedViaMobSpawner = this.spawnedViaMobSpawner; // KioCG
                 // CraftBukkit end
                 this.releaseAllPois();
                 this.discard();
