From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Joket_abc <15005771700@qq.com>
Date: Tue, 24 Oct 2023 15:42:36 +0800
Subject: [PATCH] Death drop protection


diff --git a/src/main/java/org/bukkit/craftbukkit/event/CraftEventFactory.java b/src/main/java/org/bukkit/craftbukkit/event/CraftEventFactory.java
index 70cb5d2aec1ad1cb071860e7a02f42f1ff0c1716..eb77cdc243467ccf5359079197018320afa09368 100644
--- a/src/main/java/org/bukkit/craftbukkit/event/CraftEventFactory.java
+++ b/src/main/java/org/bukkit/craftbukkit/event/CraftEventFactory.java
@@ -1007,7 +1007,12 @@ public class CraftEventFactory {
         for (org.bukkit.inventory.ItemStack stack : event.getDrops()) {
             if (stack == null || stack.getType() == Material.AIR) continue;
 
+            // KioCG start
+            Item item =
             world.dropItem(entity.getLocation(), stack);
+            item.setOwner(entity.getUniqueId());
+            ((org.bukkit.craftbukkit.entity.CraftItem) item).getHandle().age = -32767;
+            // KioCG end
         }
 
         return event;
